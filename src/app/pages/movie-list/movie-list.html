<div class="p-4">
  <h1 class="text-2xl font-bold mb-4">Movie List</h1>

  <div class="flex items-center gap-4 mb-4">
    <mat-form-field>
      <mat-icon matPrefix>search</mat-icon>
      <input matInput type="text" [formField]="searchForm.search" />
      @if (searchForm.search().value()) {
        <button matSuffix matIconButton aria-label="Clear" (click)="resetSearch()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>
    <mat-form-field>
      <mat-label>Sort By</mat-label>
      <mat-select [formField]="searchForm.sort">
        <mat-option value="title:asc">Title</mat-option>
        <mat-option value="releaseDate:desc">Release Date</mat-option>
        <mat-option [value]="['rating:desc', 'title:asc']">Rating</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Genre</mat-label>
      <mat-select [formField]="searchForm.filters.genreId">
        <mat-option value="">All Genres</mat-option>
        @for (genre of genres()?.data || []; track genre.id) {
          <mat-option [value]="genre.documentId">{{ genre.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  @if (loading()) {
    <p>Loading movies...</p>
  } @else if (movies()?.data?.length === 0) {
    <p>No movies found.</p>
  } @else {
    <div class="flex flex-wrap gap-2">
      @for (movie of movies()?.data || []; track movie.id) {
        <a [routerLink]="['/movies/', movie.documentId]" class="basis-40">
          <div class="rounded-2xl shadow-lg overflow-hidden">
            <img
              class="w-full h-64 object-cover"
              [src]="`http://localhost:1337${movie.poster.formats?.small?.url}`"
              [alt]="movie.title"
            />
            <div class="p-4">
              <h2 class="text-md font-bold">{{ movie.title }}</h2>
              <p class="text-sm text-slate-600">{{ movie.releaseDate | date: 'mediumDate' }}</p>
              <div>
                <p class="text-sm text-slate-600">{{ movie.rating }}</p>
              </div>
            </div>
          </div>
        </a>
      }
    </div>
  }
</div>
